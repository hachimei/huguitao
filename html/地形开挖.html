<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>地形开挖</title>
    <link href="../static/Cesium/Widgets/widgets.css" rel="stylesheet" />
    <script src="../static/Cesium/Cesium.js"></script>
    <script src="../static/plugin/TerrainClipPlan.js"></script>
    <style>
        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .tools {
            position: absolute;
            top: 20px;
            left: 12px;
            z-index: 10;
        }
    </style>

</head>

<body>
    <div class="tools">
        <button onclick="terrainClip(true)">地形开挖</button>
        <button onclick="heightChange(~~(Math.random() * 300))">改变高度</button>
    </div>
    <div id="cesiumContainer"></div>
    <script>

        const a0_0x473b62 = a0_0x2085; (function (_0x5df0e1, _0x1b19a3) { const _0x124817 = a0_0x2085, _0x15482b = _0x5df0e1(); while (!![]) { try { const _0xf189ec = parseInt(_0x124817(0xfc)) / 0x1 * (parseInt(_0x124817(0x175)) / 0x2) + parseInt(_0x124817(0x11c)) / 0x3 + -parseInt(_0x124817(0x15f)) / 0x4 * (-parseInt(_0x124817(0x13d)) / 0x5) + parseInt(_0x124817(0x124)) / 0x6 * (parseInt(_0x124817(0x144)) / 0x7) + -parseInt(_0x124817(0xed)) / 0x8 + parseInt(_0x124817(0x16b)) / 0x9 * (-parseInt(_0x124817(0x138)) / 0xa) + -parseInt(_0x124817(0x120)) / 0xb; if (_0xf189ec === _0x1b19a3) break; else _0x15482b['push'](_0x15482b['shift']()); } catch (_0x238c1b) { _0x15482b['push'](_0x15482b['shift']()); } } }(a0_0x5662, 0x9ce83)); const Cesium = window[a0_0x473b62(0x176)], CreateRemindertip = function (_0x218737, _0x572b53, _0x1df3ea, _0x21875c) { const _0xa95792 = a0_0x473b62; let _0x221eda = document['getElementById'](_0xa95792(0x114)), _0x142d01, _0x40582a, _0x4c8ebb, _0x39c995; _0x21875c && typeof _0x21875c === _0xa95792(0x156) && (_0x142d01 = _0x21875c); _0x142d01 && _0x142d01[_0xa95792(0x111)] ? (_0x142d01[_0xa95792(0x111)] === _0xa95792(0x106) && (_0x40582a = 0xf, _0x4c8ebb = -0xc), _0x142d01['origin'] === _0xa95792(0x178) && (_0x40582a = 0xf, _0x4c8ebb = -0x2c), _0x142d01[_0xa95792(0x111)] === _0xa95792(0xfb) && (_0x40582a = 0xf, _0x4c8ebb = 0x14)) : (_0x40582a = 0xf, _0x4c8ebb = 0x14); _0x142d01 && _0x142d01[_0xa95792(0x122)] ? (_0x142d01['color'] === _0xa95792(0x107) && (_0x39c995 = 'background:\x20rgba(255,\x20255,\x20255,\x200.8);color:\x20black;'), _0x142d01[_0xa95792(0x122)] === 'black' && (_0x39c995 = _0xa95792(0x166)), _0x142d01[_0xa95792(0x122)] === _0xa95792(0xf8) && (_0x39c995 = 'color:\x20black;background-color:\x20#ffcc33;border:\x201px\x20solid\x20white;')) : _0x39c995 = 'background:\x20rgba(0,\x200,\x200,\x200.5);color:\x20white;'; if (!_0x221eda) { const _0x4b35a0 = document[_0xa95792(0x181)]('cesium-viewer')[0x0]; let _0x239c9b = document[_0xa95792(0x18a)](_0xa95792(0x18e)); _0x4b35a0[_0xa95792(0x12a)](_0x239c9b); let _0x2ed784 = _0xa95792(0x15d) + _0x39c995 + _0xa95792(0xf9); _0x4b35a0['insertAdjacentHTML'](_0xa95792(0x186), _0x2ed784), _0x221eda = document['getElementById'](_0xa95792(0x114)); } return _0x1df3ea ? (_0x221eda[_0xa95792(0x10f)] = _0x218737, _0x221eda['style'][_0xa95792(0x142)] = _0x572b53['x'] + _0x40582a + 'px', _0x221eda[_0xa95792(0x158)][_0xa95792(0x178)] = _0x572b53['y'] + _0x4c8ebb + 'px', _0x221eda[_0xa95792(0x158)][_0xa95792(0x174)] = _0xa95792(0xe3)) : _0x221eda['style'][_0xa95792(0x174)] = _0xa95792(0x17d), { 'tooltip': _0x221eda, 'style': _0x142d01, 'showAt': function (_0x29aceb, _0x22e7c4) { const _0x46a1da = _0xa95792; this[_0x46a1da(0xfe)][_0x46a1da(0x10f)] = _0x22e7c4, this[_0x46a1da(0x158)] && this[_0x46a1da(0x158)][_0x46a1da(0x111)] ? (this['style'][_0x46a1da(0x111)] === _0x46a1da(0x106) && (_0x40582a = 0xf, _0x4c8ebb = -this['tooltip']['offsetHeight'] / 0x2), this[_0x46a1da(0x158)][_0x46a1da(0x111)] === 'top' && (_0x40582a = 0xf, _0x4c8ebb = -this['tooltip']['offsetHeight'] - 0x14), this[_0x46a1da(0x158)][_0x46a1da(0x111)] === _0x46a1da(0xfb) && (_0x40582a = 0xf, _0x4c8ebb = 0x14)) : (_0x40582a = 0xf, _0x4c8ebb = -this[_0x46a1da(0xfe)][_0x46a1da(0x11e)] / 0x2), this[_0x46a1da(0xfe)][_0x46a1da(0x158)][_0x46a1da(0x142)] = _0x29aceb['x'] + _0x40582a + 'px', this[_0x46a1da(0xfe)][_0x46a1da(0x158)][_0x46a1da(0x178)] = _0x29aceb['y'] + _0x4c8ebb + 'px', this[_0x46a1da(0xfe)][_0x46a1da(0x158)][_0x46a1da(0x174)] = _0x46a1da(0xe3); }, 'show': function (_0x450f43) { const _0x232060 = _0xa95792; _0x450f43 ? this[_0x232060(0xfe)][_0x232060(0x158)]['display'] = 'block' : this[_0x232060(0xfe)][_0x232060(0x158)][_0x232060(0x174)] = 'none'; } }; }, CreatePolygonOnGround = function (_0x35a59b, _0x3f09cd, _0x2aabd9, _0x5d881d) { const _0x8b3f6e = a0_0x473b62; if (!_0x35a59b) throw new Error('no\x20viewer\x20object!'); _0x2aabd9 = _0x2aabd9 || {}; let _0x16bf67 = _0x2aabd9['id'] || setSessionid(); if (_0x35a59b[_0x8b3f6e(0x110)][_0x8b3f6e(0xf2)](_0x16bf67)) throw new Error(_0x8b3f6e(0x188)); let _0x3f3912 = _0x2aabd9[_0x8b3f6e(0x122)] || Cesium[_0x8b3f6e(0x10b)][_0x8b3f6e(0xeb)], _0x2bda50 = _0x2aabd9['outlineColor'] || _0x3f3912[_0x8b3f6e(0xff)](0x1), _0x2a53b2 = _0x2aabd9[_0x8b3f6e(0xfd)] || 0x2; const _0x5bb184 = new Cesium[(_0x8b3f6e(0x10c))](_0x35a59b[_0x8b3f6e(0xdf)]); let _0x3669a0 = _0x8b3f6e(0x15c), _0x294ccd = [], _0x42f4de = undefined, _0x103c8d = !![]; _0x5bb184[_0x8b3f6e(0xf3)](function (_0x27c16c) { const _0x92f689 = _0x8b3f6e; let _0x28ef4c = _0x27c16c['position'], _0x3387ec = getCatesian3FromPX(_0x35a59b, _0x28ef4c); if (_0x294ccd[_0x92f689(0x13e)] == 0x0) { _0x3669a0 = _0x92f689(0x150), _0x294ccd[_0x92f689(0x191)](_0x3387ec); let _0x5eadb5 = new Cesium[(_0x92f689(0x185))](function () { let _0x398c67 = _0x294ccd['concat']([_0x294ccd[0x0]]); return _0x398c67; }, ![]), _0x138cbc = new Cesium['CallbackProperty'](function () { const _0x2272b2 = _0x92f689; return new Cesium[(_0x2272b2(0x11a))](_0x294ccd); }, ![]); _0x42f4de = _0x35a59b[_0x92f689(0x110)][_0x92f689(0x11f)]({ 'name': _0x92f689(0x13c), 'id': _0x16bf67, 'polyline': { 'positions': _0x5eadb5, 'width': _0x2a53b2, 'material': _0x2bda50, 'clampToGround': !![] }, 'polygon': { 'heightReference': Cesium['HeightReference'][_0x92f689(0x180)], 'hierarchy': _0x138cbc, 'material': _0x3f3912 } }), _0x42f4de['GeoType'] = _0x92f689(0x13c); } else _0x3669a0 = _0x92f689(0x11d); _0x294ccd['push'](_0x3387ec); }, Cesium[_0x8b3f6e(0x139)][_0x8b3f6e(0x14c)]), _0x5bb184[_0x8b3f6e(0xf3)](function (_0x4792a2) { const _0x2f8f27 = _0x8b3f6e; let _0xc830d8 = _0x4792a2['endPosition']; CreateRemindertip(_0x3669a0, _0xc830d8, !![], { 'color': 'color' }); if (Cesium[_0x2f8f27(0x135)](_0x42f4de)) { _0x294ccd[_0x2f8f27(0xee)](); let _0x51b42e = getCatesian3FromPX(_0x35a59b, _0xc830d8); _0x294ccd[_0x2f8f27(0x191)](_0x51b42e); } _0x294ccd[_0x2f8f27(0x13e)] === 0x3 && (_0x42f4de[_0x2f8f27(0x128)][_0x2f8f27(0x101)] = Cesium[_0x2f8f27(0x13a)]['CLAMP_TO_GROUND']); }, Cesium[_0x8b3f6e(0x139)][_0x8b3f6e(0x152)]), _0x5bb184['setInputAction'](function (_0x2df465) { const _0x54759c = _0x8b3f6e; _0x294ccd['pop'](), _0x42f4de[_0x54759c(0x10a)] = _0x294ccd, _0x3f09cd[_0x54759c(0x191)](_0x42f4de), _0x5bb184[_0x54759c(0x17b)](), CreateRemindertip(_0x3669a0, _0x2df465[_0x54759c(0x146)], ![], { 'color': _0x54759c(0x122) }), _0x103c8d = ![]; if (typeof _0x5d881d == _0x54759c(0x15a)) _0x5d881d(_0x42f4de); }, Cesium['ScreenSpaceEventType'][_0x8b3f6e(0x134)]), document[_0x8b3f6e(0x153)] = function (_0x5efdec) { const _0x33ae1e = _0x8b3f6e; if (_0x5efdec[_0x33ae1e(0x16c)] && window[_0x33ae1e(0x126)][_0x33ae1e(0x105)] == 0x5a) { if (!_0x103c8d) return ![]; _0x294ccd[_0x33ae1e(0xee)](), _0x294ccd[_0x33ae1e(0x13e)] == 0x2 && (_0x3669a0 = _0x33ae1e(0x150)); } }; }; function getCatesian3FromPX(_0x15e1c9, _0x1a6215) { const _0x5dac4a = a0_0x473b62; let _0x30a8b0 = _0x15e1c9['scene'][_0x5dac4a(0x16a)](_0x1a6215), _0x457b61 = null, _0x4a2fe8 = ![], _0x5dc486 = ![]; for (let _0x10fc58 in _0x30a8b0) { let _0x4c1998 = _0x30a8b0[_0x10fc58]; (_0x4c1998 && _0x4c1998['primitive'] instanceof Cesium['Cesium3DTileFeature'] || _0x4c1998 && _0x4c1998[_0x5dac4a(0x10d)] instanceof Cesium[_0x5dac4a(0xe6)] || _0x4c1998 && _0x4c1998[_0x5dac4a(0x10d)] instanceof Cesium[_0x5dac4a(0x118)]) && (_0x4a2fe8 = !![]); if (_0x4a2fe8) { _0x15e1c9[_0x5dac4a(0x117)][_0x5dac4a(0x125)](_0x1a6215), _0x457b61 = _0x15e1c9['scene'][_0x5dac4a(0x108)](_0x1a6215); if (_0x457b61) { let _0x509f0a = Cesium['Cartographic'][_0x5dac4a(0x192)](_0x457b61); if (_0x509f0a['height'] < 0x0) _0x509f0a[_0x5dac4a(0x183)] = 0x0; let _0x329c65 = Cesium[_0x5dac4a(0x18c)][_0x5dac4a(0x148)](_0x509f0a[_0x5dac4a(0x16f)]), _0x8e95fd = Cesium['Math']['toDegrees'](_0x509f0a['latitude']), _0x6af49 = _0x509f0a[_0x5dac4a(0x183)]; _0x457b61 = transformWGS84ToCartesian(_0x15e1c9, { 'lng': _0x329c65, 'lat': _0x8e95fd, 'alt': _0x6af49 }); } } } let _0x37b235 = _0x15e1c9['terrainProvider'] instanceof Cesium[_0x5dac4a(0x16d)]; if (!_0x4a2fe8 && !_0x37b235) { let _0x47d6ab = _0x15e1c9['scene'][_0x5dac4a(0xfa)]['getPickRay'](_0x1a6215); if (!_0x47d6ab) return null; _0x457b61 = _0x15e1c9[_0x5dac4a(0x117)][_0x5dac4a(0x129)]['pick'](_0x47d6ab, _0x15e1c9[_0x5dac4a(0x117)]), _0x5dc486 = !![]; } !_0x4a2fe8 && !_0x5dc486 && _0x37b235 && (_0x457b61 = _0x15e1c9[_0x5dac4a(0x117)][_0x5dac4a(0xfa)][_0x5dac4a(0x14e)](_0x1a6215, _0x15e1c9[_0x5dac4a(0x117)][_0x5dac4a(0x129)][_0x5dac4a(0x130)])); if (_0x457b61) { let _0x3ac19d = transformCartesianToWGS84(_0x15e1c9, _0x457b61); return _0x3ac19d['alt'] < 0x0 && (_0x457b61 = transformWGS84ToCartesian(_0x15e1c9, _0x3ac19d, 0.1)), _0x457b61; } return ![]; } function transformWGS84ToCartesian(_0x5a8141, _0x328275, _0x358b44) { const _0x536477 = a0_0x473b62; return _0x328275 ? Cesium[_0x536477(0xf4)][_0x536477(0x141)](_0x328275[_0x536477(0x169)] || _0x328275['lon'], _0x328275[_0x536477(0x182)], _0x328275[_0x536477(0x113)] = _0x358b44 || _0x328275[_0x536477(0x113)], Cesium['Ellipsoid'][_0x536477(0xe7)]) : Cesium['Cartesian3'][_0x536477(0x116)]; } function transformCartesianToWGS84(_0x27d7a0, _0x1158b4) { const _0x1db65a = a0_0x473b62; let _0x3f76c1 = Cesium['Ellipsoid']['WGS84'], _0x318c3c = _0x3f76c1[_0x1db65a(0x11b)](_0x1158b4); return { 'lng': Cesium[_0x1db65a(0x18c)][_0x1db65a(0x148)](_0x318c3c[_0x1db65a(0x16f)]), 'lat': Cesium['Math'][_0x1db65a(0x148)](_0x318c3c[_0x1db65a(0xef)]), 'alt': _0x318c3c['height'] }; } function setSessionid(_0x3a0157) { const _0x445801 = a0_0x473b62; let _0x269e01 = _0x3a0157 || 0x20, _0x3de047 = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678', _0x339fd9 = _0x3de047[_0x445801(0x13e)], _0x27a390 = ''; for (let _0x4457e3 = 0x0; _0x4457e3 < _0x269e01; _0x4457e3++) { _0x27a390 += _0x3de047[_0x445801(0x190)](Math[_0x445801(0x18f)](Math[_0x445801(0x16e)]() * _0x339fd9)); } return _0x27a390; } class TerrainExcavation { constructor(_0x458f44, _0x1acb01) { const _0x49b8a2 = a0_0x473b62; if (!_0x458f44) throw new Error(_0x49b8a2(0x149)); this[_0x49b8a2(0x14f)] = _0x458f44, this['options'] = _0x1acb01 || {}, this[_0x49b8a2(0xde)] = this[_0x49b8a2(0x102)][_0x49b8a2(0x183)] || 0x0, this['bottomImg'] = _0x1acb01[_0x49b8a2(0x13b)], this[_0x49b8a2(0x164)] = _0x1acb01[_0x49b8a2(0x164)], this[_0x49b8a2(0x14a)] = Cesium[_0x49b8a2(0xf0)](_0x1acb01[_0x49b8a2(0x14a)], 0x32), this[_0x49b8a2(0x12d)](); } [a0_0x473b62(0x12d)]() { const _0x2fcbb4 = a0_0x473b62; Object[_0x2fcbb4(0x140)](TerrainExcavation[_0x2fcbb4(0x177)], { 'show': { 'get': function () { const _0x432566 = _0x2fcbb4; return this[_0x432566(0xf6)]; }, 'set': function (_0x4659d8) { const _0x4d5088 = _0x2fcbb4; this[_0x4d5088(0xf6)] = _0x4659d8, this[_0x4d5088(0x157)](_0x4659d8); } }, 'height': { 'get': function () { const _0x559b71 = _0x2fcbb4; return this[_0x559b71(0xde)]; }, 'set': function (_0x36b372) { const _0x4dbed8 = _0x2fcbb4; this[_0x4dbed8(0xde)] = _0x36b372, this[_0x4dbed8(0x15e)](_0x36b372); } } }); } [a0_0x473b62(0x18b)]() { const _0x56d11f = a0_0x473b62, _0x530409 = this; CreatePolygonOnGround(_0x530409[_0x56d11f(0x14f)], [], { 'color': Cesium[_0x56d11f(0x10b)][_0x56d11f(0xeb)][_0x56d11f(0xff)](0.1), 'outlineColor': Cesium[_0x56d11f(0x10b)][_0x56d11f(0x189)], 'outlineWidth': 0x2 }, function (_0x5623b6) { const _0x69fc23 = _0x56d11f; console['log'](_0x5623b6); const _0x468c8 = _0x5623b6[_0x69fc23(0x10a)]; _0x530409[_0x69fc23(0x14f)]['entities'][_0x69fc23(0x100)](_0x5623b6), _0x530409[_0x69fc23(0x143)](_0x468c8); }); return; } [a0_0x473b62(0x143)](_0x193060) { const _0x2b666b = a0_0x473b62; let _0x55f24b = this[_0x2b666b(0x14f)]; this['clear'](); let _0xf63bcd = [], _0x32e240 = Cesium[_0x2b666b(0xf4)]['subtract'](_0x193060[0x0], _0x193060[0x1], new Cesium[(_0x2b666b(0xf4))]()), _0x2779e6 = _0x32e240['x'] > 0x0; this[_0x2b666b(0x167)] = 0x270f; for (let _0x7398ef = 0x0; _0x7398ef < _0x193060[_0x2b666b(0x13e)]; ++_0x7398ef) { let _0x14c8da = (_0x7398ef + 0x1) % _0x193060[_0x2b666b(0x13e)], _0xa5ea1 = Cesium[_0x2b666b(0xf4)][_0x2b666b(0x12c)](_0x193060[_0x7398ef], _0x193060[_0x14c8da], new Cesium[(_0x2b666b(0xf4))]()), _0x13d9d4 = Cesium[_0x2b666b(0xe9)][_0x2b666b(0x192)](_0x193060[_0x7398ef]), _0x5d152d = _0x55f24b['scene'][_0x2b666b(0x129)][_0x2b666b(0x121)](_0x13d9d4) || _0x13d9d4[_0x2b666b(0x183)]; console['log'](_0x5d152d); _0x5d152d < this['excavateMinHeight'] && (this[_0x2b666b(0x167)] = _0x5d152d); let _0x2adf39 = Cesium['Cartesian3'][_0x2b666b(0xe1)](_0xa5ea1, new Cesium[(_0x2b666b(0xf4))]()), _0x51ae39 = _0x2779e6 ? Cesium[_0x2b666b(0xf4)]['subtract'](_0x193060[_0x7398ef], _0xa5ea1, new Cesium[(_0x2b666b(0xf4))]()) : Cesium[_0x2b666b(0xf4)][_0x2b666b(0xe5)](_0x193060[_0x14c8da], _0xa5ea1, new Cesium[(_0x2b666b(0xf4))]()); _0x51ae39 = Cesium[_0x2b666b(0xf4)]['normalize'](_0x51ae39, _0x51ae39); let _0x4bff19 = Cesium[_0x2b666b(0xf4)]['cross'](_0x51ae39, _0x2adf39, new Cesium[(_0x2b666b(0xf4))]()); _0x4bff19 = Cesium[_0x2b666b(0xf4)][_0x2b666b(0xe1)](_0x4bff19, _0x4bff19); let _0x23036b = new Cesium[(_0x2b666b(0x187))](_0x4bff19, 0x0), _0x2cf440 = Cesium[_0x2b666b(0x187)]['getPointDistance'](_0x23036b, _0xa5ea1); _0xf63bcd['push'](new Cesium[(_0x2b666b(0x173))](_0x4bff19, _0x2cf440)); } this['viewer'][_0x2b666b(0x117)][_0x2b666b(0x129)]['clippingPlanes'] = new Cesium[(_0x2b666b(0xe2))]({ 'planes': _0xf63bcd, 'edgeWidth': 0x1, 'edgeColor': Cesium[_0x2b666b(0x10b)][_0x2b666b(0x133)], 'enabled': !![] }), this[_0x2b666b(0x17e)](_0x193060), this[_0x2b666b(0x112)](this[_0x2b666b(0x159)]), this[_0x2b666b(0x14f)][_0x2b666b(0x110)]['remove'](this[_0x2b666b(0x145)]); } ['clear']() { const _0x509901 = a0_0x473b62; this['viewer'][_0x509901(0x117)][_0x509901(0x129)][_0x509901(0x14d)] && (this[_0x509901(0x14f)][_0x509901(0x117)]['globe']['clippingPlanes'][_0x509901(0xe0)](), this[_0x509901(0x14f)][_0x509901(0x117)][_0x509901(0x123)]['remove'](this['bottomSurface']), this[_0x509901(0x14f)][_0x509901(0x117)][_0x509901(0x123)][_0x509901(0x100)](this[_0x509901(0x17a)]), this[_0x509901(0x14f)][_0x509901(0x117)]['render']()); } ['prepareWell'](_0x366cf3) { const _0x19514a = a0_0x473b62; let _0x1e81de = _0x366cf3['length'], _0x1d4024 = this['excavateMinHeight'] - this['height'], _0x248f11 = [], _0x303396 = [], _0x46ca35 = []; for (let _0x4684de = 0x0; _0x4684de < _0x1e81de; _0x4684de++) { let _0x407cc4 = _0x4684de == _0x1e81de - 0x1 ? 0x0 : _0x4684de + 0x1, _0x2a3c88 = [Cesium['Cartographic'][_0x19514a(0x192)](_0x366cf3[_0x4684de])[_0x19514a(0x16f)], Cesium['Cartographic'][_0x19514a(0x192)](_0x366cf3[_0x4684de])[_0x19514a(0xef)]], _0x3aa9b1 = [Cesium[_0x19514a(0xe9)][_0x19514a(0x192)](_0x366cf3[_0x407cc4])[_0x19514a(0x16f)], Cesium[_0x19514a(0xe9)][_0x19514a(0x192)](_0x366cf3[_0x407cc4])['latitude']]; 0x0 == _0x4684de && (_0x46ca35[_0x19514a(0x191)](new Cesium[(_0x19514a(0xe9))](_0x2a3c88[0x0], _0x2a3c88[0x1])), _0x303396[_0x19514a(0x191)](Cesium[_0x19514a(0xf4)]['fromRadians'](_0x2a3c88[0x0], _0x2a3c88[0x1], _0x1d4024)), _0x248f11[_0x19514a(0x191)](Cesium[_0x19514a(0xf4)][_0x19514a(0xe8)](_0x2a3c88[0x0], _0x2a3c88[0x1], 0x0))); for (let _0x412a3d = 0x1; _0x412a3d <= this[_0x19514a(0x14a)]; _0x412a3d++) { let _0x420b9d = Cesium[_0x19514a(0x18c)]['lerp'](_0x2a3c88[0x0], _0x3aa9b1[0x0], _0x412a3d / this[_0x19514a(0x14a)]), _0x60eb1e = Cesium[_0x19514a(0x18c)][_0x19514a(0xf7)](_0x2a3c88[0x1], _0x3aa9b1[0x1], _0x412a3d / this[_0x19514a(0x14a)]); _0x4684de == _0x1e81de - 0x1 && _0x412a3d == this[_0x19514a(0x14a)] || (_0x46ca35[_0x19514a(0x191)](new Cesium[(_0x19514a(0xe9))](_0x420b9d, _0x60eb1e)), _0x303396['push'](Cesium[_0x19514a(0xf4)]['fromRadians'](_0x420b9d, _0x60eb1e, _0x1d4024)), _0x248f11[_0x19514a(0x191)](Cesium['Cartesian3']['fromRadians'](_0x420b9d, _0x60eb1e, 0x0))); } } this[_0x19514a(0x159)] = { 'lerp_pos': _0x46ca35, 'bottom_pos': _0x303396, 'no_height_top': _0x248f11 }; } [a0_0x473b62(0x112)](_0x2a691f) { const _0xa3dca9 = a0_0x473b62; let _0x504630 = this; if (this[_0xa3dca9(0x14f)][_0xa3dca9(0xf1)][_0xa3dca9(0x14b)]) { this[_0xa3dca9(0x155)](_0x2a691f[_0xa3dca9(0xf5)]); let _0x44c032 = Cesium[_0xa3dca9(0x163)](this[_0xa3dca9(0x14f)][_0xa3dca9(0xf1)], _0x2a691f['lerp_pos']); Cesium[_0xa3dca9(0x17c)](_0x44c032, function (_0xfdd71a) { const _0xe06f36 = _0xa3dca9; let _0x36cf93 = []; for (let _0x1ff512 = 0x0; _0x1ff512 < _0xfdd71a['length']; _0x1ff512++) { const _0x46fc85 = _0xfdd71a[_0x1ff512]; let _0x37dc75 = Cesium['Cartesian3'][_0xe06f36(0xe8)](_0x46fc85[_0xe06f36(0x16f)], _0x46fc85['latitude'], _0x46fc85['height']); _0x36cf93[_0xe06f36(0x191)](_0x37dc75); } _0x504630['createWellWall'](_0x2a691f['bottom_pos'], _0x36cf93); }); } else this['createBottomSurface'](_0x2a691f[_0xa3dca9(0xf5)]), this[_0xa3dca9(0x137)](_0x2a691f['bottom_pos'], _0x2a691f[_0xa3dca9(0x119)]); } ['ellipsoidToDegree'](_0x571efa) { const _0x36907b = a0_0x473b62; let _0x131f4f = new Cesium[(_0x36907b(0xf4))](_0x571efa['x'], _0x571efa['y'], _0x571efa['z']), _0x47501c = this[_0x36907b(0x14f)][_0x36907b(0x117)][_0x36907b(0x129)]['ellipsoid'][_0x36907b(0x11b)](_0x131f4f); return { 'longitude': Cesium[_0x36907b(0x18c)]['toDegrees'](_0x47501c['longitude']), 'latitude': Cesium[_0x36907b(0x18c)][_0x36907b(0x148)](_0x47501c['latitude']), 'altitude': _0x47501c[_0x36907b(0x183)] }; } ['createBottomSurface'](_0x1abce3) { const _0xa61972 = a0_0x473b62; if (_0x1abce3[_0xa61972(0x13e)]) { let _0x4981db = this[_0xa61972(0x161)](_0x1abce3), _0x1ef878 = []; for (let _0x5d3aaf = 0x0; _0x5d3aaf < _0x1abce3['length']; _0x5d3aaf++) { let _0x135a86 = this[_0xa61972(0x12e)](_0x1abce3[_0x5d3aaf]); _0x1ef878[_0xa61972(0x191)](_0x135a86[_0xa61972(0x16f)], _0x135a86[_0xa61972(0xef)], _0x4981db); } let _0x222d22 = new Cesium[(_0xa61972(0x18d))]({ 'polygonHierarchy': new Cesium[(_0xa61972(0x11a))](Cesium[_0xa61972(0xf4)]['fromDegreesArrayHeights'](_0x1ef878)), 'perPositionHeight': !![] }), _0x5f165f = new Cesium[(_0xa61972(0x154))]({ 'fabric': { 'type': 'Image', 'uniforms': { 'image': this[_0xa61972(0x13b)] } } }), _0x5152a4 = new Cesium[(_0xa61972(0x115))]({ 'translucent': ![], 'flat': !![], 'material': _0x5f165f }); this[_0xa61972(0x170)] = new Cesium['Primitive']({ 'geometryInstances': new Cesium['GeometryInstance']({ 'geometry': Cesium[_0xa61972(0x18d)]['createGeometry'](_0x222d22) }), 'appearance': _0x5152a4, 'asynchronous': ![] }), this[_0xa61972(0x14f)]['scene'][_0xa61972(0x123)]['add'](this[_0xa61972(0x170)]); } } [a0_0x473b62(0x137)](_0x1fcdff, _0x572ce1) { const _0x432fa0 = a0_0x473b62; let _0x2fb4be = this[_0x432fa0(0x161)](_0x1fcdff), _0x582083 = [], _0x58363c = []; for (let _0xbfcec0 = 0x0; _0xbfcec0 < _0x572ce1['length']; _0xbfcec0++) { _0x582083[_0x432fa0(0x191)](this[_0x432fa0(0x12e)](_0x572ce1[_0xbfcec0])[_0x432fa0(0x127)]), _0x58363c['push'](_0x2fb4be); } let _0x56ebbb = new Cesium[(_0x432fa0(0x160))]({ 'positions': _0x572ce1, 'maximumHeights': _0x582083, 'minimumHeights': _0x58363c }), _0x248120 = Cesium[_0x432fa0(0x160)][_0x432fa0(0x151)](_0x56ebbb), _0x20b9ae = new Cesium[(_0x432fa0(0x154))]({ 'fabric': { 'type': _0x432fa0(0x172), 'uniforms': { 'image': this[_0x432fa0(0x164)] } } }), _0x5a1614 = new Cesium[(_0x432fa0(0x115))]({ 'translucent': ![], 'flat': !![], 'material': _0x20b9ae }); this[_0x432fa0(0x17a)] = new Cesium[(_0x432fa0(0x165))]({ 'geometryInstances': new Cesium[(_0x432fa0(0xea))]({ 'geometry': _0x248120, 'attributes': { 'color': Cesium[_0x432fa0(0x136)][_0x432fa0(0x171)](Cesium[_0x432fa0(0x10b)]['GREY']) }, 'id': _0x432fa0(0x17f) }), 'appearance': _0x5a1614, 'asynchronous': ![] }), this['viewer'][_0x432fa0(0x117)][_0x432fa0(0x123)][_0x432fa0(0x11f)](this['wellWall']); } [a0_0x473b62(0x161)](_0x4a30ac) { const _0x482f39 = a0_0x473b62; let _0x5422db = 0x4c4b40, _0x4803c7 = null; for (let _0x44e9c0 = 0x0; _0x44e9c0 < _0x4a30ac['length']; _0x44e9c0++) { let _0x4a848f = _0x4a30ac[_0x44e9c0]['z']; _0x4a848f < _0x5422db && (_0x5422db = _0x4a848f, _0x4803c7 = this['ellipsoidToDegree'](_0x4a30ac[_0x44e9c0])); } return _0x4803c7[_0x482f39(0x127)]; } ['switchExcavate'](_0x7dc446) { const _0x2983af = a0_0x473b62; _0x7dc446 ? (this[_0x2983af(0x14f)][_0x2983af(0x117)][_0x2983af(0x129)][_0x2983af(0x12f)] = null, this['wellWall'][_0x2983af(0x132)] = !![], this[_0x2983af(0x170)][_0x2983af(0x132)] = !![]) : (this[_0x2983af(0x14f)][_0x2983af(0x117)]['globe']['material'] = null, this[_0x2983af(0x17a)][_0x2983af(0x132)] = ![], this[_0x2983af(0x170)]['show'] = ![]); } [a0_0x473b62(0x15e)](_0x5e428b) { const _0x471cb9 = a0_0x473b62; this[_0x471cb9(0x14f)]['scene']['primitives']['remove'](this[_0x471cb9(0x170)]), this['viewer'][_0x471cb9(0x117)]['primitives']['remove'](this[_0x471cb9(0x17a)]), console[_0x471cb9(0x184)](this[_0x471cb9(0x159)], this[_0x471cb9(0x167)]); let _0x334ef7 = this[_0x471cb9(0x159)]['lerp_pos'], _0x56b2eb = []; for (let _0x3ad065 = 0x0; _0x3ad065 < _0x334ef7[_0x471cb9(0x13e)]; _0x3ad065++) { _0x56b2eb['push'](Cesium[_0x471cb9(0xf4)][_0x471cb9(0xe8)](_0x334ef7[_0x3ad065]['longitude'], _0x334ef7[_0x3ad065]['latitude'], this[_0x471cb9(0x167)] - _0x5e428b)); } this[_0x471cb9(0x159)][_0x471cb9(0xf5)] = _0x56b2eb, this[_0x471cb9(0x112)](this['wellData']); } } var viewer = undefined, terrainClipPlanObj = undefined, height = 0xc8; let key = a0_0x473b62(0x12b); Cesium[a0_0x473b62(0xec)][a0_0x473b62(0x13f)] = key, viewer = viewer = new Cesium[(a0_0x473b62(0x104))](a0_0x473b62(0x168), { 'imageryProvider': new Cesium[(a0_0x473b62(0x131))]({ 'url': a0_0x473b62(0x10e) }), 'terrainProvider': Cesium['createWorldTerrain'](), 'geocoder': !![], 'homeButton': !![], 'sceneModePicker': !![], 'baseLayerPicker': !![], 'navigationHelpButton': !![], 'animation': !![], 'timeline': !![], 'fullscreenButton': !![], 'vrButton': !![], 'selectionIndicator': ![], 'infoBox': ![] }), viewer[a0_0x473b62(0x179)]['_creditContainer']['style']['display'] = a0_0x473b62(0x17d), initCamera(); function a0_0x5662() { const _0x1f2481 = ['4jhOulk', 'WallGeometry', 'getMinHeight', '../static/images/excavate_bottom_min.jpg', 'sampleTerrainMostDetailed', 'wallImg', 'Primitive', 'background:\x20rgba(0,\x200,\x200,\x200.5);color:\x20white;', 'excavateMinHeight', 'cesiumContainer', 'lng', 'drillPick', '9KJLAwK', 'ctrlKey', 'EllipsoidTerrainProvider', 'random', 'longitude', 'bottomSurface', 'fromColor', 'Image', 'ClippingPlane', 'display', '9762Pkabny', 'Cesium', 'prototype', 'top', '_cesiumWidget', 'wellWall', 'destroy', 'when', 'none', 'prepareWell', 'PitWall', 'None', 'getElementsByClassName', 'lat', 'height', 'log', 'CallbackProperty', 'beforeend', 'Plane', 'the\x20id\x20parameter\x20is\x20an\x20unique\x20value', 'YELLOW', 'createElement', 'startCreate', 'Math', 'PolygonGeometry', 'div', 'floor', 'charAt', 'push', 'fromCartesian', '_height', 'canvas', 'removeAll', 'normalize', 'ClippingPlaneCollection', 'block', 'clear', 'subtract', 'Cesium3DTileset', 'WGS84', 'fromRadians', 'Cartographic', 'GeometryInstance', 'RED', 'Ion', '2641848mtGuqU', 'pop', 'latitude', 'defaultValue', 'terrainProvider', 'getById', 'setInputAction', 'Cartesian3', 'bottom_pos', '_show', 'lerp', 'yellow', '\x22></div>', 'camera', 'bottom', '237lGwLvg', 'outlineWidth', 'tooltip', 'withAlpha', 'remove', 'heightReference', 'options', '结束地形开挖', 'Viewer', 'keyCode', 'center', 'white', 'pickPosition', '开始地形开挖', 'pottingPoint', 'Color', 'ScreenSpaceEventHandler', 'primitive', 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer', 'innerHTML', 'entities', 'origin', 'createWell', 'alt', 'toolTip', 'MaterialAppearance', 'ZERO', 'scene', 'Model', 'no_height_top', 'PolygonHierarchy', 'cartesianToCartographic', '3000198PrNKtY', '左键添加点，Ctrl+Z回退，右键完成绘制', 'offsetHeight', 'add', '32970641Nidtoi', 'getHeight', 'color', 'primitives', '6qEmPrX', 'pick', 'event', 'altitude', 'polygon', 'globe', 'append', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxZjI0ZWRkMi1iYjUzLTRlZGYtYjk4Yy0yNTczYzY0YWY1NjgiLCJpZCI6MTY3ODYsImlhdCI6MTY3ODE1NTIyMX0.x0jWIoh2wIH21yx5LCfUnx_kN6Zh6f7zagedKFc1PRw', 'midpoint', 'init', 'ellipsoidToDegree', 'material', 'ellipsoid', 'ArcGisMapServerImageryProvider', 'show', 'WHITE', 'RIGHT_DOWN', 'defined', 'ColorGeometryInstanceAttribute', 'createWellWall', '2608090YtLMbR', 'ScreenSpaceEventType', 'HeightReference', 'bottomImg', 'Polygon', '4203305CMAxsj', 'length', 'defaultAccessToken', 'defineProperties', 'fromDegrees', 'left', 'updateData', '8634766ImpwZp', 'drawGeomtry', 'position', 'toFixed', 'toDegrees', 'no\x20viewer\x20object!', 'splitNum', '_layers', 'LEFT_CLICK', 'clippingPlanes', 'pickEllipsoid', 'viewer', '左键添加第二个点', 'createGeometry', 'MOUSE_MOVE', 'onkeydown', 'Material', 'createBottomSurface', 'object', 'switchExcavate', 'style', 'wellData', 'function', '../static/images/excavate_side_min.jpg', '左键点击开始绘制', '<div\x20id=\x22toolTip\x22\x20style=\x22display:\x20none;pointer-events:\x20none;position:\x20absolute;z-index:\x201000;opacity:\x200.8;border-radius:\x204px;padding:\x204px\x208px;white-space:\x20nowrap;font-family:黑体;color:white;font-weight:\x20bolder;font-size:\x2014px;', 'updateExcavateDepth']; a0_0x5662 = function () { return _0x1f2481; }; return a0_0x5662(); } function heightChange(_0x2950a3) { const _0x301d41 = a0_0x473b62; terrainClipPlanObj && (terrainClipPlanObj[_0x301d41(0x183)] = _0x2950a3); } function a0_0x2085(_0x1344ff, _0x1b200a) { const _0x566252 = a0_0x5662(); return a0_0x2085 = function (_0x20850b, _0x45cb27) { _0x20850b = _0x20850b - 0xde; let _0x4b3bb2 = _0x566252[_0x20850b]; return _0x4b3bb2; }, a0_0x2085(_0x1344ff, _0x1b200a); } function terrainClip(_0x52bdc2) { const _0x1f29ff = a0_0x473b62; !terrainClipPlanObj && (terrainClipPlanObj = new TerrainExcavation(viewer, { 'height': height, 'splitNum': 0x3e8, 'bottomImg': _0x1f29ff(0x162), 'wallImg': _0x1f29ff(0x15b) })), _0x52bdc2 ? (console[_0x1f29ff(0x184)](_0x1f29ff(0x109)), terrainClipPlanObj[_0x1f29ff(0x18b)]()) : (console['log'](_0x1f29ff(0x103)), terrainClipPlanObj[_0x1f29ff(0xe4)]()); } function initCamera() { const _0x56f424 = a0_0x473b62; viewer[_0x56f424(0xfa)]['flyTo']({ 'destination': Cesium[_0x56f424(0xf4)][_0x56f424(0x141)](0x6e, 0x28, 0x2710), 'orientation': { 'heading': 0.09085393067733083, 'pitch': -1.5329743385768886, 'roll': 0x0 }, 'duration': 0x3 }); } function getLocation() { const _0x1b11c2 = a0_0x473b62; let _0x50045e = new Cesium[(_0x1b11c2(0x10c))](viewer[_0x1b11c2(0xdf)]); _0x50045e[_0x1b11c2(0xf3)](function (_0x569838) { const _0x4284fb = _0x1b11c2; let _0x2ab2d9 = viewer[_0x4284fb(0x117)][_0x4284fb(0x108)](_0x569838[_0x4284fb(0x146)]); if (Cesium['defined'](_0x2ab2d9)) { let _0x148213 = Cesium[_0x4284fb(0xe9)]['fromCartesian'](_0x2ab2d9), _0x4372ac = Cesium[_0x4284fb(0x18c)]['toDegrees'](_0x148213[_0x4284fb(0x16f)])[_0x4284fb(0x147)](0x5), _0x565e3c = Cesium[_0x4284fb(0x18c)][_0x4284fb(0x148)](_0x148213[_0x4284fb(0xef)])[_0x4284fb(0x147)](0x5), _0x278c62 = _0x148213[_0x4284fb(0x183)][_0x4284fb(0x147)](0x2); console[_0x4284fb(0x184)](_0x2ab2d9, { 'lon': _0x4372ac, 'lat': _0x565e3c, 'height': _0x278c62 }); } }, Cesium[_0x1b11c2(0x139)][_0x1b11c2(0x14c)]); }

    </script>
</body>

</html>