<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>可视域分析</title>
  <link href="../static/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <script src="../static/kriging.js"></script>
  <script src="../static/plugin/turf.min.js"></script>
  <script src="../static/Cesium/Cesium.js"></script>
  <style>
    html,
    body,
    #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    .tools {
      position: absolute;
      top: 20px;
      left: 12px;
      z-index: 10;
    }
  </style>

</head>

<body>
  <div class="tools">
    <button onclick="start()">可视域分析</button>
    <button onclick="vaObj.clearAll();">清除</button>
  </div>
  <div id="cesiumContainer">
    <canvas id="canvasMap" style="display: none"> </canvas>
  </div>
  <script>

    function a0_0x1864() { const _0xcba663 = ['_cesiumWidget', 'initHandler', 'substr', 'GEODESIC', 'createViewshed', 'remove', '19088dqHgrP', 'fromRotationMatrix', '175604pvvKQZ', 'toDataURL', 'exponential', 'toRadians', 'width', 'style', 'createFrustum', 'Quaternion', 'negate', 'aspectRatio', 'EllipsoidGraphics', '8936PAvRfI', '35PZfTRn', 'fromCartesian', '795153SgOfGr', 'YELLOWGREEN', 'Cartographic', 'lats', 'no\x20viewer\x20object!', 'Cesium3DTileset', 'train', 'toDegrees', 'fromColor', 'multiplyByPointAsVector', 'PI_OVER_TWO', 'createTargetPoints', 'random', 'addVisualPyramid', 'ScreenSpaceEventType', 'Ellipsoid', 'LEFT_UP', 'secondPos', 'viewershedPolygon', 'setLightCamera', 'direction', 'GeometryInstance', 'pickPosition', '659540uljtZa', 'endPosition', 'visualRange', 'directionWC', 'Transforms', 'coordinates', 'longitude', 'values', 'defined', 'FrustumOutlineGeometry', 'setColumn', 'features', 'latitude', '20qwauZw', 'refreshBBox', '#ff000080', 'fromDegreesArray', 'RADIANS_PER_DEGREE', 'log', 'image/png', 'horizontalViewAngle', 'normalize', 'entities', 'Color', 'enableRotate', 'length', 'frustum', 'GroundPrimitive', 'getPitch', 'VERTEX_FORMAT', '2719882tAVHnF', 'add', 'getElementById', 'verticalViewAngle', 'lightCamera', 'ViewShedOptions', 'grid', '//lab.earthsdk.com/model/8c5299e0ce5f11eab7a4adf1d6568ff7/tileset.json', 'viewer', 'Image', 'ColorGeometryInstanceAttribute', 'Matrix3', 'canvasEle', 'setEndPoints', 'Matrix4', 'upWC', 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer', 'cartesian3ToDegree', 'WGS84', 'canvas', 'distance', 'Cartesian3', 'tan', 'ellipsoid', 'lngs', 'handler', 'viewPosition', 'firstPos', '#00ff0080', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxZjI0ZWRkMi1iYjUzLTRlZGYtYjk4Yy0yNTczYzY0YWY1NjgiLCJpZCI6MTY3ODYsImlhdCI6MTY3ODE1NTIyMX0.x0jWIoh2wIH21yx5LCfUnx_kN6Zh6f7zagedKFc1PRw', 'pitch', 'destroy', 'screenSpaceCameraController', '视椎体轮廓线', 'plot', 'height', 'cos', 'pyramid', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>这是绘制的视椎体起点</p>', 'toFixed', 'eastNorthUpToFixedFrame', 'defaultAccessToken', '2cvPYDh', 'ViewershedPolygon', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>这是绘制的视椎体视角终点</p>', 'drawViewershed', 'debugModelMatrixPrimitive', 'far', 'acosClamped', 'prototype', 'polygon', 'BLUE', '297306dCUcyQ', 'push', 'getHeight', 'PolygonGeometry', '1323KEljgn', 'withAlpha', 'sampleHeight', 'cartesianToCartographic', 'rightWC', 'Material', 'fromDegrees', 'depthTestAgainstTerrain', 'PolygonHierarchy', 'PerInstanceColorAppearance', 'Cesium', 'Primitive', 'LEFT_DOWN', 'atan2', 'getAngle', 'none', 'pickFromRay', 'ScreenSpaceEventHandler', '_creditContainer', 'DebugModelMatrixPrimitive', 'returnImgae', 'RED', 'clear', 'ShowGeometryInstanceAttribute', 'subtract', 'YELLOW', 'Math', 'frustumPrimitive', 'primitives', 'position', 'canvasMap', 'fov', 'Entity', 'scene', 'updateViewShed', 'setInputAction', 'positionArr']; a0_0x1864 = function () { return _0xcba663; }; return a0_0x1864(); } const a0_0x252129 = a0_0x2ae2; (function (_0x25ab3b, _0x3179d8) { const _0xb32d4d = a0_0x2ae2, _0x33cfb3 = _0x25ab3b(); while (!![]) { try { const _0x15e04c = -parseInt(_0xb32d4d(0x17f)) / 0x1 * (-parseInt(_0xb32d4d(0x1ec)) / 0x2) + parseInt(_0xb32d4d(0x18d)) / 0x3 + -parseInt(_0xb32d4d(0x17d)) / 0x4 + parseInt(_0xb32d4d(0x1a4)) / 0x5 + -parseInt(_0xb32d4d(0x1f6)) / 0x6 * (-parseInt(_0xb32d4d(0x18b)) / 0x7) + -parseInt(_0xb32d4d(0x18a)) / 0x8 * (parseInt(_0xb32d4d(0x1fa)) / 0x9) + -parseInt(_0xb32d4d(0x1b1)) / 0xa * (parseInt(_0xb32d4d(0x1c2)) / 0xb); if (_0x15e04c === _0x3179d8) break; else _0x33cfb3['push'](_0x33cfb3['shift']()); } catch (_0x5ca4a9) { _0x33cfb3['push'](_0x33cfb3['shift']()); } } }(a0_0x1864, 0x26497)); const Cesium = window[a0_0x252129(0x204)]; let ViewShedAnalysis = function (_0x2076b2, _0x4acd65) { const _0x432178 = a0_0x252129; if (!_0x2076b2) throw new Error(_0x432178(0x191)); let _0x1df483 = document[_0x432178(0x1c4)](_0x4acd65); if (!_0x1df483) throw new Error('the\x20canvas\x20element\x20is\x20not\x20exist'); this['canvasEle'] = _0x1df483, this[_0x432178(0x1ca)] = _0x2076b2, this[_0x432178(0x1db)] = undefined, this[_0x432178(0x1c6)], this[_0x432178(0x1e7)], this[_0x432178(0x215)], this['viewershedPolygon']; }; ViewShedAnalysis[a0_0x252129(0x1f3)] = { 'initHandler'() { const _0x132996 = a0_0x252129; this[_0x132996(0x1db)] && (this[_0x132996(0x1db)][_0x132996(0x1e1)](), this[_0x132996(0x1db)] = undefined); }, 'createViewshed': function (_0x470b17) { const _0xe888c3 = a0_0x252129; let _0xaeb58e = this, _0x54f132 = _0xaeb58e[_0xe888c3(0x1ca)][_0xe888c3(0x21b)]; _0xaeb58e[_0xe888c3(0x178)](), _0xaeb58e['clearAll'](), _0xaeb58e[_0xe888c3(0x1db)] = new Cesium[(_0xe888c3(0x20b))](_0xaeb58e[_0xe888c3(0x1ca)]['canvas']), _0xaeb58e[_0xe888c3(0x1db)][_0xe888c3(0x21d)](_0xc82a55 => { const _0x190570 = _0xe888c3; _0x54f132[_0x190570(0x1e2)][_0x190570(0x1bc)] = ![], _0x54f132[_0x190570(0x1e2)]['enableZoom'] = ![], _0x54f132['globe'][_0x190570(0x201)] = !![]; let _0x4d7f0a = _0x54f132['pickPosition'](_0xc82a55['position']), _0x428450 = _0xaeb58e['cartesian3ToDegree'](_0x4d7f0a); _0xaeb58e[_0x190570(0x1db)][_0x190570(0x21d)](function (_0x1bacc4) { const _0x29e3b5 = _0x190570; let _0x3be72f = _0x54f132[_0x29e3b5(0x1a3)](_0x1bacc4[_0x29e3b5(0x1a5)]); if (Cesium['defined'](_0x3be72f)) { let _0x5e7ac9 = _0xaeb58e[_0x29e3b5(0x1d3)](_0x3be72f), _0x43ecc1 = Cesium['Cartesian3'][_0x29e3b5(0x1d6)](_0x3be72f, _0x4d7f0a), _0x142697 = _0xaeb58e[_0x29e3b5(0x208)](_0x428450[0x0], _0x428450[0x1], _0x5e7ac9[0x0], _0x5e7ac9[0x1]), _0x37c8eb = _0xaeb58e[_0x29e3b5(0x1c0)](_0x4d7f0a, _0x3be72f); _0xaeb58e[_0x29e3b5(0x1c7)] = { 'viewPosition': _0x4d7f0a, 'endPosition': _0x3be72f, 'direction': _0x142697, 'pitch': _0x37c8eb, 'horizontalViewAngle': 0x5a, 'verticalViewAngle': 0x3c, 'visibleAreaColor': Cesium[_0x29e3b5(0x1bb)]['GREEN'], 'invisibleAreaColor': Cesium['Color']['RED'], 'visualRange': _0x43ecc1 }, _0xaeb58e[_0x29e3b5(0x21c)](); } }, Cesium[_0x190570(0x19b)]['MOUSE_MOVE']); }, Cesium[_0xe888c3(0x19b)][_0xe888c3(0x206)]), _0xaeb58e[_0xe888c3(0x1db)]['setInputAction'](() => { const _0x5cd17e = _0xe888c3; _0xaeb58e[_0x5cd17e(0x178)](), _0x54f132[_0x5cd17e(0x1e2)][_0x5cd17e(0x1bc)] = !![], _0x54f132[_0x5cd17e(0x1e2)]['enableZoom'] = !![], _0xaeb58e[_0x5cd17e(0x1ef)](_0x470b17); }, Cesium[_0xe888c3(0x19b)][_0xe888c3(0x19d)]); }, 'ReturnDistance'(_0x4dcc71, _0x2bb682) { const _0x3342a7 = a0_0x252129; let _0x18d89c = 0x0, _0x71abde = Cesium[_0x3342a7(0x18f)]['fromCartesian'](_0x4dcc71), _0x51aeda = Cesium['Cartographic'][_0x3342a7(0x18c)](_0x2bb682), _0x13105a = new Cesium['EllipsoidGeodesic'](); _0x13105a[_0x3342a7(0x1cf)](_0x71abde, _0x51aeda); let _0x3f60d2 = _0x13105a['surfaceDistance']; return _0x3f60d2; }, 'getHeight'(_0x2695e8, _0x5b8153, _0x34a21b) { const _0x155368 = a0_0x252129; let _0x539bae = Cesium[_0x155368(0x18f)]['fromDegrees'](_0x2695e8, _0x5b8153), _0x158d08 = this[_0x155368(0x1ca)][_0x155368(0x21b)][_0x155368(0x1fc)](_0x539bae, _0x34a21b); return _0x158d08; }, 'cartesian3ToDegree': function (_0x1d4770) { const _0x417144 = a0_0x252129; let _0x24e826 = this[_0x417144(0x1ca)][_0x417144(0x21b)]['globe'][_0x417144(0x1d9)], _0x5a97bd = _0x24e826[_0x417144(0x1fd)](_0x1d4770), _0x34b0a5 = Cesium['Math'][_0x417144(0x194)](_0x5a97bd['latitude']), _0x61f8a2 = Cesium[_0x417144(0x214)]['toDegrees'](_0x5a97bd['longitude']), _0x18e909 = _0x5a97bd[_0x417144(0x1e5)]; return [_0x61f8a2, _0x34b0a5, _0x18e909]; }, 'getAngle': function (_0x1accaf, _0x14452d, _0x581705, _0x389fc4) { const _0x848137 = a0_0x252129; let _0x5a82fc = Math[_0x848137(0x207)](Math['abs'](_0x1accaf - _0x581705), Math['abs'](_0x14452d - _0x389fc4)); return _0x581705 >= _0x1accaf ? _0x5a82fc = _0x389fc4 < _0x14452d ? Math['PI'] - _0x5a82fc : _0x5a82fc : _0x5a82fc = _0x389fc4 >= _0x14452d ? 0x2 * Math['PI'] - _0x5a82fc : Math['PI'] + _0x5a82fc, _0x5a82fc = _0x5a82fc * 0xb4 / Math['PI'], _0x5a82fc; }, 'getPitch'(_0x346d37, _0x36e840) { const _0x11f445 = a0_0x252129; let _0x5e689a = Cesium[_0x11f445(0x1a8)]['eastNorthUpToFixedFrame'](_0x346d37); const _0x5ee2db = Cesium[_0x11f445(0x1d7)][_0x11f445(0x212)](_0x36e840, _0x346d37, new Cesium[(_0x11f445(0x1d7))]()); let _0x4227ed = Cesium[_0x11f445(0x1d0)][_0x11f445(0x196)](Cesium[_0x11f445(0x1d0)]['inverse'](_0x5e689a, _0x5e689a), _0x5ee2db, _0x5ee2db); return Cesium[_0x11f445(0x1d7)][_0x11f445(0x1b9)](_0x4227ed, _0x4227ed), Cesium[_0x11f445(0x214)][_0x11f445(0x197)] - Cesium['Math'][_0x11f445(0x1f2)](_0x4227ed['z']); }, 'updateViewShed': function () { const _0x3d479d = a0_0x252129; this[_0x3d479d(0x210)](), this[_0x3d479d(0x1a0)](), this[_0x3d479d(0x19a)](), this[_0x3d479d(0x185)](); }, 'clear': function () { const _0x8abc34 = a0_0x252129; this[_0x8abc34(0x1e7)] && (this[_0x8abc34(0x1ca)][_0x8abc34(0x1ba)]['removeById'](this['pyramid']['id']), this[_0x8abc34(0x1e7)] = undefined), this[_0x8abc34(0x215)] && (this[_0x8abc34(0x1ca)][_0x8abc34(0x21b)][_0x8abc34(0x216)][_0x8abc34(0x17c)](this[_0x8abc34(0x215)]), this[_0x8abc34(0x215)] = undefined), this['debugModelMatrixPrimitive'] && (this['viewer'][_0x8abc34(0x21b)][_0x8abc34(0x216)][_0x8abc34(0x17c)](this[_0x8abc34(0x1f0)]), this[_0x8abc34(0x1f0)] = undefined); }, 'clearAll': function () { const _0x13e6dd = a0_0x252129; this[_0x13e6dd(0x210)](), this[_0x13e6dd(0x19f)] && (this['viewer'][_0x13e6dd(0x21b)][_0x13e6dd(0x216)][_0x13e6dd(0x17c)](this[_0x13e6dd(0x19f)]), this[_0x13e6dd(0x19f)] = undefined); }, 'addVisualPyramid': function () { const _0x3c6213 = a0_0x252129; let _0x8465e6 = this[_0x3c6213(0x1c7)], _0x40a423 = _0x8465e6['viewPosition'], _0x5e13d9 = Number(_0x8465e6['visualRange']), _0x4e99dd = Cesium[_0x3c6213(0x1a8)][_0x3c6213(0x1ea)](_0x40a423); this[_0x3c6213(0x1f0)] = this[_0x3c6213(0x1ca)][_0x3c6213(0x21b)][_0x3c6213(0x216)]['add'](new Cesium[(_0x3c6213(0x20d))]({ 'modelMatrix': _0x4e99dd, 'length': 0x5 })); const _0x5da456 = _0x8465e6[_0x3c6213(0x1b8)] / 0x2, _0x5e99b1 = _0x8465e6[_0x3c6213(0x1c5)] / 0x2, _0x4eae5f = Cesium[_0x3c6213(0x214)]['toDegrees'](_0x8465e6['pitch']), _0x5bcaa2 = new Cesium[(_0x3c6213(0x189))]({ 'radii': new Cesium['Cartesian3'](_0x5e13d9, _0x5e13d9, _0x5e13d9), 'minimumClock': Cesium[_0x3c6213(0x214)][_0x3c6213(0x182)](0x5a - _0x8465e6[_0x3c6213(0x1a1)] - _0x5da456), 'maximumClock': Cesium['Math'][_0x3c6213(0x182)](0x5a - _0x8465e6[_0x3c6213(0x1a1)] + _0x5da456), 'minimumCone': Cesium['Math'][_0x3c6213(0x182)](0x5a - _0x4eae5f - _0x5e99b1), 'maximumCone': Cesium[_0x3c6213(0x214)][_0x3c6213(0x182)](0x5a - _0x4eae5f + _0x5e99b1), 'fill': ![], 'outline': !![], 'subdivisions': 0x100, 'stackPartitions': 0x40, 'slicePartitions': 0x40, 'outlineColor': Cesium[_0x3c6213(0x1bb)][_0x3c6213(0x18e)][_0x3c6213(0x1fb)](0.5) }), _0x3010c0 = new Cesium[(_0x3c6213(0x21a))]({ 'position': _0x40a423, 'ellipsoid': _0x5bcaa2 }); this['pyramid'] = this[_0x3c6213(0x1ca)][_0x3c6213(0x1ba)][_0x3c6213(0x1c3)](_0x3010c0); }, 'setLightCamera': function () { const _0x49066c = a0_0x252129; !this['lightCamera'] && (this[_0x49066c(0x1c6)] = new Cesium['Camera'](this[_0x49066c(0x1ca)][_0x49066c(0x21b)])); let _0x1f52bb = this[_0x49066c(0x1c7)], _0x345799 = Number(_0x1f52bb[_0x49066c(0x1a6)]); this[_0x49066c(0x1c6)][_0x49066c(0x217)] = _0x1f52bb[_0x49066c(0x1dc)], this[_0x49066c(0x1c6)][_0x49066c(0x1be)]['near'] = 0.1, this[_0x49066c(0x1c6)][_0x49066c(0x1be)][_0x49066c(0x1f1)] = _0x345799; const _0x4bcb00 = Cesium['Math'][_0x49066c(0x182)](_0x1f52bb['horizontalViewAngle']), _0x11aee1 = Cesium[_0x49066c(0x214)]['toRadians'](_0x1f52bb[_0x49066c(0x1c5)]); this[_0x49066c(0x1c6)][_0x49066c(0x1be)][_0x49066c(0x188)] = _0x345799 * Math['tan'](_0x4bcb00 / 0x2) * 0x2 / (_0x345799 * Math[_0x49066c(0x1d8)](_0x11aee1 / 0x2) * 0x2), this['lightCamera'][_0x49066c(0x1be)][_0x49066c(0x219)] = _0x4bcb00 > _0x11aee1 ? _0x4bcb00 : _0x11aee1, this[_0x49066c(0x1c6)]['setView']({ 'destination': _0x1f52bb['viewPosition'], 'orientation': { 'heading': Cesium[_0x49066c(0x214)]['toRadians'](_0x1f52bb[_0x49066c(0x1a1)] || 0x0), 'pitch': _0x1f52bb[_0x49066c(0x1e0)] || 0x0, 'roll': 0x0 } }); }, 'createFrustum': function () { const _0x4af615 = a0_0x252129, _0x365650 = new Cesium[(_0x4af615(0x1d7))](), _0x2cbdbc = new Cesium[(_0x4af615(0x1cd))](), _0x129b1f = new Cesium[(_0x4af615(0x186))](), _0xa0fe34 = this[_0x4af615(0x1c6)][_0x4af615(0x1a7)], _0x218e63 = this['lightCamera'][_0x4af615(0x1d1)]; let _0x2c0721 = this[_0x4af615(0x1c6)][_0x4af615(0x1fe)]; _0x2c0721 = Cesium['Cartesian3'][_0x4af615(0x187)](_0x2c0721, _0x365650); let _0x4e00df = _0x2cbdbc; Cesium['Matrix3'][_0x4af615(0x1ae)](_0x4e00df, 0x0, _0x2c0721, _0x4e00df), Cesium['Matrix3'][_0x4af615(0x1ae)](_0x4e00df, 0x1, _0x218e63, _0x4e00df), Cesium[_0x4af615(0x1cd)][_0x4af615(0x1ae)](_0x4e00df, 0x2, _0xa0fe34, _0x4e00df); let _0x3917ab = Cesium['Quaternion'][_0x4af615(0x17e)](_0x4e00df, _0x129b1f), _0x3d5a6f = new Cesium[(_0x4af615(0x1a2))]({ 'geometry': new Cesium[(_0x4af615(0x1ad))]({ 'frustum': this[_0x4af615(0x1c6)][_0x4af615(0x1be)], 'origin': this[_0x4af615(0x1c7)]['viewPosition'], 'orientation': _0x3917ab }), 'id': _0x4af615(0x1e3) + Math[_0x4af615(0x199)]()['toString'](0x24)[_0x4af615(0x179)](0x2), 'attributes': { 'color': Cesium[_0x4af615(0x1cc)][_0x4af615(0x195)](new Cesium[(_0x4af615(0x1bb))](0x0, 0x1, 0x0, 0x1)), 'show': new Cesium[(_0x4af615(0x211))](!![]) } }); this['frustumPrimitive'] = this['viewer'][_0x4af615(0x21b)][_0x4af615(0x216)][_0x4af615(0x1c3)](new Cesium[(_0x4af615(0x205))]({ 'geometryInstances': _0x3d5a6f, 'appearance': new Cesium[(_0x4af615(0x203))]({ 'flat': !![], 'translucent': ![], 'closed': !![] }) })); }, 'createPoint': function (_0x1664ba, _0x1c8abd) { const _0x1e715c = a0_0x252129; let _0x1fa693 = new Cesium['Entity']({ 'name': _0x1e715c(0x1dd), 'show': !![], 'position': _0x1664ba, 'point': { 'show': !![], 'pixelSize': 0x14, 'color': Cesium[_0x1e715c(0x1bb)]['RED'], 'outlineColor': Cesium[_0x1e715c(0x1bb)][_0x1e715c(0x213)], 'outlineWidth': 0x5 }, 'description': _0x1e715c(0x1e8) }); this[_0x1e715c(0x1ca)][_0x1e715c(0x1ba)][_0x1e715c(0x1c3)](_0x1fa693); let _0x40505b = new Cesium['Entity']({ 'name': _0x1e715c(0x19e), 'show': !![], 'position': _0x1c8abd, 'point': { 'show': !![], 'pixelSize': 0x1e, 'color': Cesium[_0x1e715c(0x1bb)][_0x1e715c(0x213)], 'outlineColor': Cesium['Color'][_0x1e715c(0x20f)], 'outlineWidth': 0x8 }, 'description': _0x1e715c(0x1ee) }); this[_0x1e715c(0x1ca)][_0x1e715c(0x1ba)][_0x1e715c(0x1c3)](_0x40505b); }, 'add'(_0x1a9e65) { const _0x11ec8b = a0_0x252129; let _0x4e7cd4 = new Cesium[(_0x11ec8b(0x1f9))]({ 'polygonHierarchy': new Cesium[(_0x11ec8b(0x202))](Cesium[_0x11ec8b(0x1d7)][_0x11ec8b(0x1b4)](_0x1a9e65)), 'height': 0x0, 'extrudedHeight': 0x0, 'vertexFormat': Cesium['PerInstanceColorAppearance'][_0x11ec8b(0x1c1)], 'stRotation': 0x0, 'ellipsoid': Cesium[_0x11ec8b(0x19c)][_0x11ec8b(0x1d4)], 'granularity': Cesium[_0x11ec8b(0x214)][_0x11ec8b(0x1b5)], 'perPositionHeight': ![], 'closeTop': !![], 'closeBottom': !![], 'arcType': Cesium['ArcType'][_0x11ec8b(0x17a)] }), _0x25bbef = new Cesium[(_0x11ec8b(0x1a2))]({ 'geometry': _0x4e7cd4, 'name': _0x11ec8b(0x1ed), 'attributes': { 'color': Cesium['ColorGeometryInstanceAttribute'][_0x11ec8b(0x195)](Cesium[_0x11ec8b(0x1bb)][_0x11ec8b(0x1f5)]['withAlpha'](0.6)), 'show': new Cesium['ShowGeometryInstanceAttribute'](!![]) } }); this['viewershedPolygon'] = this[_0x11ec8b(0x1ca)][_0x11ec8b(0x21b)][_0x11ec8b(0x216)]['add'](new Cesium[(_0x11ec8b(0x1bf))]({ 'geometryInstances': _0x25bbef, 'appearance': new Cesium['EllipsoidSurfaceAppearance']({ 'aboveGround': !![], 'material': new Cesium[(_0x11ec8b(0x1ff))]({ 'fabric': { 'type': _0x11ec8b(0x1cb), 'uniforms': { 'image': this[_0x11ec8b(0x20e)]() } } }) }) })); }, 'drawViewershed'(_0xd6e784) { const _0x58fb58 = a0_0x252129, _0x9c42a3 = this['cartesian3ToDegree'](this[_0x58fb58(0x1c7)]['viewPosition']), _0x407dd0 = this['ViewShedOptions'][_0x58fb58(0x1a6)], _0x501cc1 = this[_0x58fb58(0x1c7)][_0x58fb58(0x1a1)]; let _0x41f716 = this['computeBoundaryOptions'](_0x9c42a3, _0x407dd0, _0x501cc1); const _0x568e45 = _0x41f716['bbox']; let _0x218b18 = turf[_0x58fb58(0x1f4)]([_0x41f716['boundaryPoints']]); const _0x4bdbe9 = this[_0x58fb58(0x1c7)][_0x58fb58(0x1a6)] / (_0xd6e784 * 0x3e8); let _0x44c577 = turf['pointGrid'](_0x568e45, _0x4bdbe9, { 'mask': _0x218b18 }); console[_0x58fb58(0x1b6)](this[_0x58fb58(0x1c7)][_0x58fb58(0x1a6)], _0xd6e784, _0x4bdbe9); let _0x460083 = this[_0x58fb58(0x198)](_0x44c577, _0x4bdbe9, _0x9c42a3), _0x5512a4 = kriging[_0x58fb58(0x193)](_0x460083[_0x58fb58(0x1ab)], _0x460083[_0x58fb58(0x1da)], _0x460083[_0x58fb58(0x190)], _0x58fb58(0x181), 0x0, 0x64), _0x133254 = kriging[_0x58fb58(0x1c8)]([_0x41f716['boundaryPoints']], _0x5512a4, _0x4bdbe9 / 0x3e8); const _0x59ce42 = [_0x58fb58(0x1b3), _0x58fb58(0x1b3), _0x58fb58(0x1b3), '#ff000080', _0x58fb58(0x1b3), _0x58fb58(0x1b3), _0x58fb58(0x1de), '#00ff0080', _0x58fb58(0x1de), '#00ff0080', '#00ff0080', _0x58fb58(0x1de)]; this[_0x58fb58(0x1ce)][_0x58fb58(0x183)] = 0xf00, this['canvasEle']['height'] = 0x870, kriging[_0x58fb58(0x1e4)](this['canvasEle'], _0x133254, [_0x568e45[0x0], _0x568e45[0x2]], [_0x568e45[0x1], _0x568e45[0x3]], _0x59ce42), this[_0x58fb58(0x1c3)](_0x41f716[_0x58fb58(0x21e)]); }, 'computeBoundaryOptions'(_0x2a3914, _0x379fc2, _0x408d9e) { const _0x77dd96 = a0_0x252129; let _0x3cafd4 = 0x615299, _0xd3651c = 0x60fef5; const _0x190d12 = _0x2a3914[0x0], _0x25dba3 = _0x2a3914[0x1], _0x1de016 = [_0x190d12, _0x25dba3, _0x190d12, _0x25dba3]; let _0x17af09 = [], _0x15f764 = []; _0x17af09[_0x77dd96(0x1f7)](_0x190d12, _0x25dba3), _0x15f764[_0x77dd96(0x1f7)]([_0x190d12, _0x25dba3]); let _0x3d7817 = _0x408d9e + 0x2d > 0x168 ? _0x408d9e - 0x2d - 0x168 : _0x408d9e - 0x2d, _0x3935d0 = _0x3d7817 + 0x5a; for (let _0x283875 = _0x3d7817; _0x283875 <= _0x3935d0; _0x283875++) { let _0x547d57 = _0x379fc2 * Math['sin'](_0x283875 * Math['PI'] / 0xb4), _0x17b3b0 = _0x379fc2 * Math[_0x77dd96(0x1e6)](_0x283875 * Math['PI'] / 0xb4), _0x2b26d2 = _0xd3651c + (_0x3cafd4 - _0xd3651c) * (0x5a - _0x25dba3) / 0x5a, _0xe4c3c9 = _0x2b26d2 * Math['cos'](_0x25dba3 * Math['PI'] / 0xb4), _0x238cb5 = _0x190d12 + _0x547d57 / _0xe4c3c9 * 0xb4 / Math['PI'], _0x44328e = _0x25dba3 + _0x17b3b0 / _0x2b26d2 * 0xb4 / Math['PI']; _0x17af09[_0x77dd96(0x1f7)](_0x238cb5, _0x44328e), _0x15f764[_0x77dd96(0x1f7)]([_0x238cb5, _0x44328e]), this[_0x77dd96(0x1b2)](_0x1de016, _0x238cb5, _0x44328e); } return _0x15f764[_0x77dd96(0x1f7)]([_0x190d12, _0x25dba3]), { 'positionArr': _0x17af09, 'boundaryPoints': _0x15f764, 'bbox': _0x1de016 }; }, 'refreshBBox'(_0x5d633f, _0x53a8f7, _0x3c8941) { _0x5d633f[0x0] = _0x53a8f7 < _0x5d633f[0x0] ? _0x53a8f7 : _0x5d633f[0x0], _0x5d633f[0x1] = _0x3c8941 < _0x5d633f[0x1] ? _0x3c8941 : _0x5d633f[0x1], _0x5d633f[0x2] = _0x53a8f7 > _0x5d633f[0x2] ? _0x53a8f7 : _0x5d633f[0x2], _0x5d633f[0x3] = _0x3c8941 > _0x5d633f[0x3] ? _0x3c8941 : _0x5d633f[0x3]; }, 'createTargetPoints'(_0x1fe8bb, _0x32f1e0, _0x55e670) { const _0x515ff4 = a0_0x252129; let _0x3a0eec = [], _0x25ecf8 = [this[_0x515ff4(0x215)], this[_0x515ff4(0x1e7)], this[_0x515ff4(0x1f0)]], _0x1387d1 = [], _0x1f5149 = [], _0x47d128 = [], _0x464a70 = this[_0x515ff4(0x1f8)](_0x55e670[0x0], _0x55e670[0x1], _0x25ecf8); _0x3a0eec[_0x515ff4(0x1f7)]({ 'x': _0x55e670[0x0], 'y': _0x55e670[0x1], 'z': _0x464a70 }); let _0x2aa02b = this[_0x515ff4(0x1c7)][_0x515ff4(0x1dc)]; for (let _0x29d8f1 = 0x0; _0x29d8f1 < _0x1fe8bb['features'][_0x515ff4(0x1bd)]; _0x29d8f1++) { const _0x25aae2 = _0x1fe8bb[_0x515ff4(0x1af)][_0x29d8f1], _0x3bffb7 = _0x25aae2['geometry'][_0x515ff4(0x1a9)], _0x434087 = _0x3bffb7[0x0], _0xcbc9a5 = _0x3bffb7[0x1]; let _0x2a2129 = this[_0x515ff4(0x1f8)](_0x434087, _0xcbc9a5, _0x25ecf8), _0x1721cf = Cesium[_0x515ff4(0x1d7)][_0x515ff4(0x200)](_0x434087, _0xcbc9a5, _0x2a2129), _0x3a58f7 = Cesium['Cartesian3']['normalize'](Cesium['Cartesian3'][_0x515ff4(0x212)](_0x1721cf, _0x2aa02b, new Cesium['Cartesian3']()), new Cesium[(_0x515ff4(0x1d7))]()), _0x1ab67d = new Cesium['Ray'](_0x2aa02b, _0x3a58f7), _0x5a2a2d = this['viewer'][_0x515ff4(0x21b)][_0x515ff4(0x20a)](_0x1ab67d, _0x25ecf8); if (_0x5a2a2d) { let _0x1c6f85 = this['ReturnDistance'](_0x1721cf, _0x5a2a2d[_0x515ff4(0x217)]); _0x1c6f85 > _0x32f1e0 ? _0x1387d1[_0x515ff4(0x1f7)](0x0) : _0x1387d1['push'](0x1), _0x1f5149[_0x515ff4(0x1f7)](_0x434087), _0x47d128['push'](_0xcbc9a5); } } return { 'values': _0x1387d1, 'lngs': _0x1f5149, 'lats': _0x47d128 }; }, 'returnImgae'() { const _0x24783a = a0_0x252129; return this['canvasEle'][_0x24783a(0x180)](_0x24783a(0x1b7)); } }; let key = a0_0x252129(0x1df); Cesium['Ion'][a0_0x252129(0x1eb)] = key; var viewer = new Cesium['Viewer']('cesiumContainer', { 'imageryProvider': new Cesium['ArcGisMapServerImageryProvider']({ 'url': a0_0x252129(0x1d2) }), 'terrainProvider': Cesium['createWorldTerrain'](), 'geocoder': !![], 'homeButton': !![], 'sceneModePicker': !![], 'baseLayerPicker': !![], 'navigationHelpButton': !![], 'animation': !![], 'timeline': !![], 'fullscreenButton': !![], 'vrButton': !![], 'selectionIndicator': ![], 'infoBox': ![] }); function a0_0x2ae2(_0x313410, _0xae18c8) { const _0x1864c8 = a0_0x1864(); return a0_0x2ae2 = function (_0x2ae24a, _0x2a1aed) { _0x2ae24a = _0x2ae24a - 0x178; let _0x4ee90e = _0x1864c8[_0x2ae24a]; return _0x4ee90e; }, a0_0x2ae2(_0x313410, _0xae18c8); } viewer[a0_0x252129(0x21f)][a0_0x252129(0x20c)][a0_0x252129(0x184)]['display'] = a0_0x252129(0x209); var vaObj = new ViewShedAnalysis(viewer, a0_0x252129(0x218)); initModel(), getLocation(); function start() { const _0x265832 = a0_0x252129; vaObj[_0x265832(0x17b)](0xa); } function clear() { vaObj['clearAll'](); } function initModel() { const _0x507d27 = a0_0x252129; let _0x11a241 = new Cesium[(_0x507d27(0x192))]({ 'url': _0x507d27(0x1c9) }); viewer[_0x507d27(0x21b)]['primitives'][_0x507d27(0x1c3)](_0x11a241), viewer['flyTo'](_0x11a241); } function getLocation() { const _0x2c3c3f = a0_0x252129; let _0x466366 = new Cesium[(_0x2c3c3f(0x20b))](viewer[_0x2c3c3f(0x1d5)]); _0x466366[_0x2c3c3f(0x21d)](function (_0x4aabfd) { const _0x5d0fb2 = _0x2c3c3f; let _0x2fdaff = viewer['scene'][_0x5d0fb2(0x1a3)](_0x4aabfd[_0x5d0fb2(0x217)]); if (Cesium[_0x5d0fb2(0x1ac)](_0x2fdaff)) { let _0x5c8f8a = Cesium[_0x5d0fb2(0x18f)][_0x5d0fb2(0x18c)](_0x2fdaff), _0x1b3765 = Cesium[_0x5d0fb2(0x214)][_0x5d0fb2(0x194)](_0x5c8f8a[_0x5d0fb2(0x1aa)])[_0x5d0fb2(0x1e9)](0x5), _0x168a72 = Cesium[_0x5d0fb2(0x214)][_0x5d0fb2(0x194)](_0x5c8f8a[_0x5d0fb2(0x1b0)])[_0x5d0fb2(0x1e9)](0x5), _0x197ac9 = _0x5c8f8a['height']['toFixed'](0x2); console[_0x5d0fb2(0x1b6)](_0x2fdaff, { 'lon': _0x1b3765, 'lat': _0x168a72, 'height': _0x197ac9 }); } }, Cesium['ScreenSpaceEventType']['LEFT_CLICK']); }

  </script>
</body>

</html>